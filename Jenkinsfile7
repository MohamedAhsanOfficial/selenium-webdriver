pipeline {
    agent any
    parameters {
        choice(name: 'ACTION', choices: ['Remove Virtualenv', 'Leave Virtualenv'], description: 'What would you like to do with the virtual environment?')
    }
    stages {
        stage('Setup Virtual Environment') {
            steps {
                script {
                    // Create and activate virtual environment, install dependencies
                    sh '''
                        python3 -m venv my_env
                        . my_env/bin/activate
                        pip install --upgrade pip
                        pip install selenium webdriver-manager
                    '''
                }
            }
        }

        stage('Run Selenium Tests') {
            steps {
                script {
                    // Activate virtual environment and run the test script
                    sh '''
                        . my_env/bin/activate
                        python firsttest.py
                    '''
                }
            }
        }

        stage('Decide Action') {
            steps {
                script {
                    // Based on user input, decide whether to remove the virtual environment
                    if (params.ACTION == 'Remove Virtualenv') {
                        echo 'Removing virtual environment as per user choice.'
                        sh 'rm -rf my_env'
                    } else {
                        echo 'Leaving virtual environment intact.'
                    }
                }
            }
        }
    }
}
